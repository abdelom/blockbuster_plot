# Blockbuster

## Overview

Blokbuster is a software tool designed to infer past population size changes based on Site Frequency Spectrum (SFS) data. It combines a C program (`blockbuster_main.c`) that processes the SFS and a Python script that visualizes and analyzes the results.

## Requirements

### Dependencies

To run this software, you'll need the following dependencies:

Python:
- Python 3.8 or newer
- NumPy
- Matplotlib
- demes
- demesdraw

C Compiler and Build Tools:
- GCC (or appropriate compiler for your platform)
- Make

Additional Utilities:
- CMake (if building C dependencies)
- Pkg-config
- Coreutils, Findutils, libgcc

### Installation

You can install the required dependencies by creating a Conda environment. The following steps will guide you through setting up the environment and running the code.

1. Create the Conda Environment

To create the environment, download or copy the `environment.yml` file, and run:

conda env create -f environment.yml

This will create a Conda environment called `blockbuster_env` with all the necessary dependencies installed.

2. Activate the Conda Environment

After the environment is created, activate it with:

conda activate blockbuster_env


4. Format the entry file

The input file must contain the SFS on a single line. If the SFS is folded, it needs to be completed with zeros so that there are exactly n â€“ 1 bins in the SFS (see example_sfs.blk and folded_example_sfs.blk).

5. Running the Programs

a. Using Bash Script

A bash script is provided to simplify the execution of the software. You can run it as follows:

bash blockbuster.sh --sfs <path_to_sfs_file> --prefixe_directory <output_directory> [options]

After building the C program, you can run the C program and Python script as follows:

b. Running the C Program (`blockbuster_main`)

./bin/blockbuster_main -p <output_directory> -s <sfs_file> 

- `-p` (required): Prefix directory where the output will be stored.
- `-s` (required): The Site Frequency Spectrum (SFS) file.
- `-b`, --blocks: Number of blocks to divide the SFS for training and test sets (default: 1, training set and teste set are the same). Not recommended.
- `-u`, --upper_bound: Upper bound for the time grid in units of Ne(0) generations (default: 2). It is not recommended to modify this value.
- `-l`, --lower_bound: Lower bound for the time grid in Ne(0) generations (default: 1e-4).
- `-c`, --changes: Maximum number of population size changes for exhaustive search (default: 5). 
- `-o`, --oriented: Oriented flag. Set to 0 if the SFS is folded (default: 1).
- `-t`, --truncation:  Troncation value (default: 0). If set to n, the inference is performed over the first n SFS bins; the remaining bins are ignored.
- `-S`, --singleton:  Whether to consider singletons (default: 1). If set to 1, the singleton bin is included; if set to 0, it is excluded.

c. Running the Python Script

After running the C program, you can analyze the output using the Python script. To do so, run:

python parsandplot.py -i <input_file> -o <output_directory> -L <genome_length> -m <mutation_rate> -g <generation_time>

- `-i` (required): The input file generated by the C program (`scenarios.txt`).
- `-o` (required): Directory to save the plot.
- `-L`: Genome length (default: -1).
- `-m`: Mutation rate (default: -1).
- `-g`: Generation time in years (default: -1).


6. Output

## License

This software is open-source and released under the MIT license.

## Contact

For issues or questions, feel free to open an issue on the GitHub repository or contact the maintainers.
